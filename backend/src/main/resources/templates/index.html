<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæŠ€æœ¯æ—¥æŠ¥ - æ¯æ—¥è‡ªåŠ¨æ±‡æ€»AIæŠ€æœ¯é¢†åŸŸçš„çƒ­é—¨æ–‡ç« </title>
    <!-- ç§»é™¤å¤–éƒ¨CDNä¾èµ–ï¼Œä½¿ç”¨å†…è”æ ·å¼ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header {
            text-align: center;
            padding: 60px 0 40px;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }
        
        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            color: #6c757d;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .main-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .today-highlights {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .today-highlights h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            text-align: center;
        }
        
        .highlight-item {
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f4;
            color: #495057;
            font-size: 1rem;
        }
        
        .highlight-item:last-child {
            border-bottom: none;
        }
        
        .highlight-item::before {
            content: "â€¢";
            color: #007bff;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .report-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            border: 1px solid #e9ecef;
        }
        
        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
        }
        
        .report-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .report-time {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 15px;
        }
        
        .report-summary {
            color: #495057;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .load-more {
            text-align: center;
            margin-top: 40px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .no-reports {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .no-reports .icon-large {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #dee2e6;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .main-container {
                padding: 20px 15px;
            }
            
            .today-highlights,
            .report-card {
                padding: 20px;
            }
        }
        
        /* è°ƒè¯•æ ·å¼ */
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <!-- è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º -->
    <div id="debug-info" class="debug-info" style="display: none;">
        <div>é¡µé¢çŠ¶æ€: <span id="page-status">åŠ è½½ä¸­...</span></div>
        <div>åŠ è½½æ—¶é—´: <span id="load-time">-</span></div>
        <div>å…ƒç´ æ•°é‡: <span id="element-count">-</span></div>
    </div>

    <!-- å¤´éƒ¨ -->
    <div class="header">
        <div class="container">
            <h1>AI æŠ€æœ¯æ—¥æŠ¥</h1>
            <p class="subtitle">æ¯æ—¥è‡ªåŠ¨æ±‡æ€» AI æŠ€æœ¯é¢†åŸŸçš„çƒ­é—¨æ–‡ç« ï¼Œæä¾›ç®€çŸ­æ‘˜è¦ã€‚</p>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="main-container">
        <!-- å†å²æ—¥æŠ¥åˆ—è¡¨ -->
        <div id="reports-container">
            <!-- ä»Šæ—¥æ—¥æŠ¥ - æ˜¾ç¤ºå®Œæ•´å†…å®¹ -->
            <div class="report-card" th:if="${dailyReport != null}">
                <div class="report-title" th:text="${dailyReport.reportDate + ' AIæ—¥æŠ¥'}">2025-05-28 AIæ—¥æŠ¥</div>
                <div class="report-time" th:text="${dailyReport.reportDate + ' å‘å¸ƒ'}">2025-05-28 å‘å¸ƒ</div>
                
                <!-- æ˜¾ç¤ºå®Œæ•´çš„æ—¥æŠ¥å†…å®¹ -->
                <div class="report-content">
                    <!-- æ–°æ ¼å¼ï¼šä»Šæ—¥æ€»ç»“ -->
                    <div th:if="${dailyReport.todayTrends}" style="margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; margin-bottom: 10px; border-left: 4px solid #007bff; padding-left: 10px;">ğŸ“ˆ ä»Šæ—¥æ€»ç»“</h3>
                        <div style="color: #495057; line-height: 1.6;" th:text="${dailyReport.todayTrends}">
                            ä»Šæ—¥æŠ€æœ¯æ€»ç»“å†…å®¹...
                        </div>
                    </div>
                    
                    <!-- æ–°æ ¼å¼ï¼šæ¨èæ–‡ç«  -->
                    <div th:if="${dailyReport.recommendedArticles}" style="margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; margin-bottom: 15px; border-left: 4px solid #28a745; padding-left: 10px;">ğŸ“š ä»Šæ—¥ä¼˜è´¨æ–‡ç« æ¨è</h3>
                        <div class="recommended-articles-home" th:attr="data-articles=${dailyReport.recommendedArticles}">
                            <!-- æ¨èæ–‡ç« å°†é€šè¿‡JavaScriptæ¸²æŸ“ -->
                        </div>
                    </div>
                    
                    <!-- æ–°æ ¼å¼ï¼šæ¯æ—¥ä¸€è¯­ -->
                    <div th:if="${dailyReport.dailyQuote}" style="margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; margin-bottom: 10px; border-left: 4px solid #ffc107; padding-left: 10px;">ğŸŒŸ æ¯æ—¥ä¸€è¯­</h3>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; font-style: italic; position: relative;">
                            <div th:text="${dailyReport.dailyQuote}" style="font-size: 1.1rem; line-height: 1.5;">
                                æ¯æ—¥ä¸€è¯­å†…å®¹...
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;" th:if="${dailyReport.solarTerm}">
                                <span th:text="'â€” ' + ${dailyReport.solarTerm}">â€” èŠ‚æ°”</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å…¼å®¹æ—§æ ¼å¼ï¼šæ˜¾ç¤ºå®Œæ•´å†…å®¹ -->
                    <div th:if="${dailyReport.todayTrends == null and dailyReport.content != null}" style="margin-bottom: 20px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; margin-bottom: 10px; border-left: 4px solid #6c757d; padding-left: 10px;">ğŸ“„ å®Œæ•´æ—¥æŠ¥</h3>
                        <div class="report-full-content" th:utext="${#strings.replace(#strings.replace(dailyReport.content, '&#10;', '<br/>'), '**', '<strong>').replace('**', '</strong>')}" style="color: #495057; line-height: 1.6;">
                            å®Œæ•´çš„æ—¥æŠ¥å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
                        </div>
                    </div>
                </div>
                
                <!-- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® -->
                <div style="text-align: center; margin-top: 20px;">
                    <a th:href="@{'/report/' + ${dailyReport.id}}" class="btn" style="background: #6c757d; text-decoration: none;">
                        ğŸ“– æŸ¥çœ‹è¯¦æƒ…é¡µé¢
                    </a>
                </div>
            </div>
            
            <!-- å†å²æ—¥æŠ¥å ä½ç¬¦ -->
            <div class="report-card" onclick="showComingSoon()">
                <div class="report-title">2025-05-27 AIæ—¥æŠ¥</div>
                <div class="report-time">2025-05-27 å‘å¸ƒ</div>
                <div class="report-summary">
                    æ˜¨æ—¥AIæŠ€æœ¯é¢†åŸŸé‡è¦è¿›å±•å›é¡¾ï¼Œæ¶µç›–æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰å¤šä¸ªæ–¹å‘çš„æœ€æ–°ç ”ç©¶æˆæœã€‚
                </div>
            </div>
            
            <div class="report-card" onclick="showComingSoon()">
                <div class="report-title">2025-05-26 AIæ—¥æŠ¥</div>
                <div class="report-time">2025-05-26 å‘å¸ƒ</div>
                <div class="report-summary">
                    æœ¬æœŸèšç„¦å¤§æ¨¡å‹æŠ€æœ¯çªç ´ã€AIåº”ç”¨è½åœ°æ¡ˆä¾‹åˆ†æï¼Œä»¥åŠå¼€æºAIå·¥å…·çš„æœ€æ–°å‘å±•åŠ¨æ€ã€‚
                </div>
            </div>
            
            <div class="report-card" onclick="showComingSoon()">
                <div class="report-title">2025-05-25 AIæ—¥æŠ¥</div>
                <div class="report-time">2025-05-25 å‘å¸ƒ</div>
                <div class="report-summary">
                    AIä¼¦ç†ä¸å®‰å…¨ã€è®¡ç®—æœºè§†è§‰æ–°è¿›å±•ã€ä»¥åŠAIåœ¨å„è¡Œä¸šçš„åˆ›æ–°åº”ç”¨æ¡ˆä¾‹æ·±åº¦è§£æã€‚
                </div>
            </div>
        </div>

        <!-- æ— æ—¥æŠ¥æ—¶æ˜¾ç¤º -->
        <div class="no-reports" th:if="${dailyReport == null}">
            <div class="icon-large">ğŸ“°</div>
            <h3>ä»Šæ—¥AIæ—¥æŠ¥å°šæœªç”Ÿæˆ</h3>
            <p>ç³»ç»Ÿæ­£åœ¨æ”¶é›†ä»Šæ—¥çš„AIæŠ€æœ¯æ–‡ç« ï¼Œè¯·ç¨åæŸ¥çœ‹æˆ–æ‰‹åŠ¨ç”Ÿæˆæ—¥æŠ¥ã€‚</p>
            <button class="btn btn-success" onclick="generateTodayReport()">
                <span class="icon">âœ¨</span> ç«‹å³ç”Ÿæˆä»Šæ—¥AIæ—¥æŠ¥
            </button>
        </div>

        <!-- åŠ è½½æ›´å¤š -->
        <div class="load-more">
            <button class="btn" onclick="loadMoreReports()">
                <span class="icon">â¬‡ï¸</span> æŸ¥çœ‹æ›´å¤šå†å²æ—¥æŠ¥
            </button>
        </div>
    </div>

    <script>
        // é¡µé¢æ€§èƒ½ç›‘æ§ - ç«‹å³æ‰§è¡Œ
        const pageStartTime = performance.now();
        const debugInfo = document.getElementById('debug-info');
        const pageStatus = document.getElementById('page-status');
        const loadTime = document.getElementById('load-time');
        const elementCount = document.getElementById('element-count');
        
        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        debugInfo.style.display = 'block';
        pageStatus.textContent = 'è„šæœ¬å¼€å§‹æ‰§è¡Œ';
        
        console.log('ğŸš€ é¡µé¢å¼€å§‹åŠ è½½æ—¶é—´:', new Date().toLocaleTimeString());
        console.log('ğŸ”§ è°ƒè¯•è„šæœ¬å¼€å§‹æ‰§è¡Œ');
        
        // ç«‹å³æ£€æŸ¥é¡µé¢çŠ¶æ€
        function updateDebugInfo() {
            const currentTime = performance.now() - pageStartTime;
            loadTime.textContent = currentTime.toFixed(2) + 'ms';
            elementCount.textContent = document.querySelectorAll('*').length;
        }
        
        updateDebugInfo();
        
        // ç›‘æ§DOMå†…å®¹åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            const domTime = performance.now() - pageStartTime;
            console.log('ğŸ“„ DOMå†…å®¹åŠ è½½å®Œæˆï¼Œè€—æ—¶:', domTime.toFixed(2) + 'ms');
            pageStatus.textContent = 'DOMåŠ è½½å®Œæˆ';
            updateDebugInfo();
            
            // æ£€æŸ¥é¡µé¢å…ƒç´ 
            const dailyReport = document.querySelector('.today-highlights');
            const reportCards = document.querySelectorAll('.report-card');
            const noReports = document.querySelector('.no-reports');
            
            console.log('ğŸ” é¡µé¢å…ƒç´ æ£€æŸ¥:', {
                hasDailyReport: !!dailyReport,
                reportCardsCount: reportCards.length,
                hasNoReportsSection: !!noReports,
                pageTitle: document.title,
                bodyClasses: document.body.className
            });
            
            // æ¸²æŸ“é¦–é¡µæ¨èæ–‡ç« 
            renderHomeRecommendedArticles();
            
            console.log('ğŸ¯ AIæŠ€æœ¯æ—¥æŠ¥é¦–é¡µDOMåŠ è½½å®Œæˆ');
        });
        
        // æ¸²æŸ“é¦–é¡µæ¨èæ–‡ç« 
        function renderHomeRecommendedArticles() {
            const container = document.querySelector('.recommended-articles-home');
            if (!container) return;
            
            const articlesData = container.getAttribute('data-articles');
            if (!articlesData) return;
            
            try {
                const articles = JSON.parse(articlesData);
                let html = '';
                
                articles.forEach((article, index) => {
                    html += `
                        <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f8f9fa;">
                            <h4 style="color: #2c3e50; margin-bottom: 10px; font-size: 1rem;">
                                <span style="background: #007bff; color: white; padding: 2px 6px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">${index + 1}</span>
                                ${article.title}
                            </h4>
                            
                            <div style="margin-bottom: 8px; font-size: 0.9rem;">
                                <strong>ğŸ”— é“¾æ¥ï¼š</strong> 
                                <a href="${article.url}" target="_blank" style="color: #007bff; text-decoration: none; word-break: break-all;">${article.url}</a>
                            </div>
                            
                            <div style="margin-bottom: 8px; font-size: 0.9rem;">
                                <strong>ğŸ“ ç®€ä»‹ï¼š</strong> 
                                <span style="color: #495057;">${article.summary}</span>
                            </div>
                            
                            <div style="margin-bottom: 8px; font-size: 0.9rem;">
                                <strong>ğŸ’¡ æ¨èç†ç”±ï¼š</strong> 
                                <span style="color: #495057;">${article.reason}</span>
                            </div>
                            
                            <div style="font-size: 0.8rem; color: #6c757d;">
                                ğŸ“‚ ${article.source || 'æœªçŸ¥æ¥æº'} 
                                ${article.author ? `| ğŸ‘¤ ${article.author}` : ''}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('è§£æé¦–é¡µæ¨èæ–‡ç« æ•°æ®å¤±è´¥:', error);
                container.innerHTML = '<p style="color: #6c757d; text-align: center; font-style: italic;">æ¨èæ–‡ç« æ•°æ®æ ¼å¼é”™è¯¯</p>';
            }
        }
        
        // ç›‘æ§èµ„æºåŠ è½½
        window.addEventListener('load', function() {
            const loadTime = performance.now() - pageStartTime;
            console.log('âœ… é¡µé¢å®Œå…¨åŠ è½½å®Œæˆï¼Œè€—æ—¶:', loadTime.toFixed(2) + 'ms');
            pageStatus.textContent = 'é¡µé¢åŠ è½½å®Œæˆ';
            updateDebugInfo();
            
            // 3ç§’åéšè—è°ƒè¯•ä¿¡æ¯
            setTimeout(() => {
                debugInfo.style.display = 'none';
            }, 3000);
        });
        
        // ç”Ÿæˆä»Šæ—¥æ—¥æŠ¥
        function generateTodayReport() {
            console.log('ğŸ”„ å¼€å§‹ç”Ÿæˆä»Šæ—¥æ—¥æŠ¥...');
            const button = event.target;
            const originalText = button.innerHTML;
            const startTime = performance.now();
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            button.innerHTML = '<span class="spinner"></span> ç”Ÿæˆä¸­...';
            button.disabled = true;
            
            fetch('/api/daily-report', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                const responseTime = performance.now() - startTime;
                console.log('ğŸ“¡ APIå“åº”æ—¶é—´:', responseTime.toFixed(2) + 'ms');
                console.log('ğŸ“Š å“åº”çŠ¶æ€:', response.status, response.statusText);
                return response.json();
            })
            .then(data => {
                const totalTime = performance.now() - startTime;
                console.log('âœ… æ—¥æŠ¥ç”Ÿæˆå®Œæˆï¼Œæ€»è€—æ—¶:', totalTime.toFixed(2) + 'ms');
                console.log('ğŸ“„ å“åº”æ•°æ®:', data);
                
                if (data.success) {
                    alert('AIæ—¥æŠ¥ç”ŸæˆæˆåŠŸï¼é¡µé¢å³å°†åˆ·æ–°ã€‚');
                    window.location.reload();
                } else {
                    alert('ç”Ÿæˆå¤±è´¥ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            })
            .catch(error => {
                const errorTime = performance.now() - startTime;
                console.error('âŒ è¯·æ±‚å¤±è´¥ï¼Œè€—æ—¶:', errorTime.toFixed(2) + 'ms');
                console.error('ğŸš¨ é”™è¯¯è¯¦æƒ…:', error);
                alert('ç”Ÿæˆå¤±è´¥ï¼šç½‘ç»œé”™è¯¯');
            })
            .finally(() => {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                button.innerHTML = originalText;
                button.disabled = false;
            });
        }
        
        // æ˜¾ç¤ºå³å°†æ¨å‡ºæç¤º
        function showComingSoon() {
            console.log('â„¹ï¸ ç”¨æˆ·ç‚¹å‡»å†å²æ—¥æŠ¥');
            alert('å†å²æ—¥æŠ¥åŠŸèƒ½å³å°†æ¨å‡ºï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }
        
        // åŠ è½½æ›´å¤šæ—¥æŠ¥
        function loadMoreReports() {
            console.log('â„¹ï¸ ç”¨æˆ·ç‚¹å‡»åŠ è½½æ›´å¤š');
            alert('æ›´å¤šå†å²æ—¥æŠ¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }
        
        // é”™è¯¯ç›‘æ§
        window.addEventListener('error', function(e) {
            console.error('ğŸš¨ é¡µé¢é”™è¯¯:', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                error: e.error
            });
            pageStatus.textContent = 'é¡µé¢é”™è¯¯: ' + e.message;
        });
        
        // æœªå¤„ç†çš„Promiseé”™è¯¯
        window.addEventListener('unhandledrejection', function(e) {
            console.error('ğŸš¨ æœªå¤„ç†çš„Promiseé”™è¯¯:', e.reason);
            pageStatus.textContent = 'Promiseé”™è¯¯';
        });
        
        console.log('ğŸ”§ è°ƒè¯•è„šæœ¬åŠ è½½å®Œæˆ');
    </script>
</body>
</html> 